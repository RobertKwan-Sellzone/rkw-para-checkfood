<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<title>Proto-Questionnaire VueJS v.4</title>

	<script src="https://unpkg.com/vue@next"></script>
	<script src="./LCQ-definitions.js"></script>
	<script src="./conversions.js"></script>

</head>

<body>
	<div id="appLCQForm">
		<select name="category" v-model="pickedCateg" @change="selectCateg">
			<option value="-undefined-">(sélectionnez une catégorie)</option>
			<option value="CONGELS">Température des stockages surgelés</option>
			<option value="FRIGOS">Température des stockages réfrigérés</option>
			<option value="DLCS">Conservation des produits</option>
			<option value="HUILES">Huiles de cuisson</option>
			<option value="GRILLS">Cuissons des produits grillés</option>
			<option value="CHAUFFE">Conservation des produits chauds</option>
			<option value="NETTOYAGE">Nettoyage du matériel</option>
		</select>

		<div>
			<h1>%[myNewForm.formLabel]%</h1>
			<div v-for="item in myNewForm.items" :key="item.$$$idkey">
				<component :is="item.type" :item="item"></component>
				<hr>
			</div>
		</div>
	</div>

	<body>

		<script>
			//CONVERSIONS.JS TESTING -- START
			//let myNewForm = buildNewForm('CONGELS');
			//console.log(myNewForm);
			//CONVERSIONS.JS TESTING -- END

			var ALERTE_VERTE = "ALERTE_VERTE";
			var ALERTE_ORANGE = "ALERTE_ORANGE";
			var ALERTE_ROUGE = "ALERTE_ROUGE";

			const appLCQForm = Vue.createApp({
				delimiters: ['%[', ']%'],
				data() {
					return {
						myNewForm: '',
						pickedCateg: '-undefined-',
					}
				},
				methods: {
					selectCateg() {
						this.myNewForm = buildNewForm(this.pickedCateg);
						console.log(this.myNewForm);
					}
				},
			});

			const ItemCheck = {
				delimiters: ['%[', ']%'],
				props: {
					item: {
						type: Object,
					}
				},
				data() {
					return {
						picked: String,
						alert_lvl: '',
					};
				},
				methods: {
					itemChanged() {

						if (this.picked == "none" && this.item.warn_NONE) {
							this.alert_lvl = this.item.warn_NONE;
						}
						else if (this.picked == "nok" && this.item.warn_NOK) {
							this.alert_lvl = this.item.warn_NOK;
						}
						else {
							this.alert_lvl = '';
						}
					}
				},
				template: `
					<div :class="alert_lvl" >
						<p>%[item.label]%</p>
						<input type="radio" :id="'ok_' +item.$$$idkey" value="ok" v-model="picked" @change="itemChanged"/>
						<label :for="'ok_' + item.$$$idkey">Fait</label>

						<input type="radio" :id="'nok_' + item.$$$idkey" value="nok" v-model="picked" @change="itemChanged"/>
						<label :for="'nok_' + item.$$$idkey">Pas fait</label>

						<input type="radio" :id="'none_' + item.$$$idkey" value="none" v-model="picked" @change="itemChanged"/>
						<label :for="'none_' + item.$$$idkey">Pas encore fait</label>
					</div>
				`
			};

			const ItemTemperature = {
				delimiters: ['%[', ']%'],
				props: {
					item: {
						type: Object,
					},
				},
				data() {
					return {
						value: Number,
						alert_lvl: '',
					};
				},
				methods: {
					compareValue(event) {
						this.value = event.target.value;

						if (this.value > this.item.max_ROUGE || this.value < this.item.min_ROUGE) {
							this.alert_lvl = ALERTE_ROUGE;
						}
						else if (this.value > this.item.max_ORANGE || this.value < this.item.min_ORANGE) {
							this.alert_lvl = ALERTE_ORANGE;
						}
						else {
							this.alert_lvl = ALERTE_VERTE;
						}
					}
				},
				template: `
					<div :class="alert_lvl">
						<p>%[item.label]%</p>
						<input type="number" step="0.1" @input="compareValue" placeholder="Saisir la température" :name="item.label">°C
						<p>%[alert_lvl]%</p>
						<hr>
					</div>
				`
			};
/*
			const ItemContentLevel = {
				delimiters: ['%[', ']%'],
				props: {
					item: {
						type: Object,
					},
				},
				data() {
					return {
						value: Number,
						compare_cnt_lvl: '',
					};
				},
				methods: {
					compareValue(event) {
						this.value = event.target.value;
						if (this.value > this.item.max_ROUGE) {
							this.compare_cnt_lvl = ALERT_ROUGE;
						}
						else if (this.value > this.item.max_ORANGE) {
							this.compare_cnt_lvl = ALERTE_ORANGE;
						}
						else {
							this.compare_cnt_lvl = ALERTE_VERTE;
						}
					}
				},
				template: `
					<div>
						<p>%[item.label]%</p>
						<input type="number" step="0.1" @input="compareValue" placeholder="Saisir la température" :name="item.label" :id="item.$$$idkey">°C
						<p>%[compare_cnt_lvl]%</p>
						<hr>
					</div>
				`
			};
*/

			appLCQForm.component("check", ItemCheck);
			appLCQForm.component("temperature", ItemTemperature);
			//appLCQForm.component("content-level", ItemContentLevel);
			appLCQForm.mount('#appLCQForm');
		</script>

</html>
